<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Header -->
    {% include 'html/header.html' %}
</head>

<body>

    <!-- SideNavbar -->
    {% include 'html/sidenav.html' %}
    <div class="main-container" style="padding-top: 0;">
        <div class="container" style="max-width: 1800px;">
            <div class="row">
                <div class="col-lg-5 overflow-scroll" style="height: 100vh; padding: 20px 20px 0 0;">
                    <div class="col-scroll">

                        <!-- Athlete Info/Header -->
                        <div class="main-header justify-content-between">
                            <h1>{{ athleteProf.fname }} {{ athleteProf.lname }}</h1>
                            <i class="fa-solid fa-pen" style="color: var(--yellow-accent); font-size: 25px;"></i>
                        </div>

                        <div class="d-flex" style="height: 200px;">
                            {% if testType %}
                            <img class="athlete-pic" src="/staticfiles/images/{{ athleteProf.image }}"></img>
                            {% else %}
                            <img class="athlete-pic" src="/staticfiles/images/{{ athleteProf.image }}"></img>
                            {% endif %}
                            <div class="w-100" style="margin-left: 20px;">
                                <div class="d-flex justify-content-between">
                                    <h6>Sport</h6>
                                    <h6 class="text-end">{{ athleteProf.sportsteam }}</h6>
                                </div>
                                <div class="line-2"></div>
                                <div class="d-flex justify-content-between">
                                    <h6>Position</h6>
                                    <h6 class="text-end">{{ athleteProf.position }}</h6>
                                </div>
                                <div class="line-2"></div>
                                <div class="d-flex justify-content-between">
                                    <h6>Year</h6>
                                    <h6 class="text-end">{{ athleteProf.year }}</h6>
                                </div>
                                <div class="line-2"></div>
                                <div class="d-flex justify-content-between">
                                    <h6>Height</h6>
                                    <h6 class="text-end">{{ athleteProf.height }}</h6>
                                </div>

                                <!--<div class="line-2"></div>
                                <div style="display: flex; justify-content: space-between;">
                                    <h6>DOB</h6> <h6>{{ athleteProf.DOB }}</h6>
                                </div> -->
                            </div>
                        </div>

                        <!-- KPI Trends -->
                        <div class="kpireport">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3>KPI Trend Report</h3>
                                <div class="text-end d-flex">
                                    <p style="font-size: 16px" id="resultone">DD/MM/YY</p>
                                    <p style="font-size: 16px">&nbsp; to &nbsp;</p>
                                    <p style="font-size: 16px" id="resulttwo">DD/MM/YY</p>
                                </div>
                            </div>

                            <hr>
                                {% load sublist_selector %}
                                
                                
                                {% for x in kpi_test_data %}
                                <div class="d-flex justify-content-between align-items-center kpi-img">
                                    
                                    <p> {{ x|get:'test_type' }} </p>
                                    {% if x|get:'change' > 0 %}
                                    <p style="color:var(--green-accent);"> 
                                        <i class="fa-solid fa-arrow-up" style="color:var(--green-accent)"></i> 
                                        {{ x|get:'change' }}
                                    </p>
                                    {% elif x|get:'change' < 0 %}
                                    <p style="color:var(--red-accent);"> 
                                        <i class="fa-solid fa-arrow-down" style="color:var(--red-accent)"></i> 
                                        {{ x|get:'change' }}
                                    </p>
                                    {% else %}
                                    <p style="color:white;">{{ x|get:'change' }}</p>
                                    {% endif %}

                                    <div style="width: 50%;">
                                        <img src="data:image/png;base64, {{ x|get:'line_graph'|safe }}">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <p> {{ x|get:'prev_val' }}</p>
                                            <p> {{ x|get:'latest_val' }}</p>
                                        </div>
                                    </div>
                                </div>

                                <hr>
                                {% endfor %}  

                                <a href="{% url 'AddKPI' athleteProf.fname athleteProf.lname athleteProf.dob %}">
                                    <button class="kpidatabtn" style="margin-top: 20px;">Add KPI</button>
                                </a>    
              
                            </div>

                        <form method="post" id="wellnessform">
                            {% csrf_token %}
                            <div class="d-flex justify-content-between">
                                <select id="wellnessdate" name="wellnessdate">
                                    <option disabled hidden selected>Select Date</option>
                                    {% for x in wellnessReportDates %}
                                    <option>{{ x.date }}</option>
                                    {% endfor %}
                                </select>
                                <input type="submit" value="submit" class="submit">
                                <p style="font-size: 16px" id="wellnessresult">DD/MM/YY</p>
                            </div>
                        </form>

                        <!-- Wellness -->

                        {% if wellness %}
                        {% for x in mostRecentWellnessReport %}

                        <div class="d-flex">
                            <div class="w-100 wellness-status-display" style="margin-right: 12px;" id="bor">
                                <h4 id="stat">Status: {{ x.status }}</h4>
                            </div>
                            <div class="w-100 wellness-status-display"
                                style="margin-left: 12px; border: 1px solid white;">
                                <div class="d-flex justify-content-center">
                                    <h4>Readiness: &nbsp;</h4>
                                    <h4 id="total"></h4>
                                </div>
                            </div>
                        </div>

                        <a href="{% url 'AddWellness' athleteProf.fname athleteProf.lname athleteProf.dob %}">
                            <button class="kpidatabtn" style="margin-top: 20px;">Add Wellness Report</button>
                        </a>

                        <script type="text/javascript">
                            var hoursofsleep = Number("{{ x.hoursofsleep }}")
                            var sleepquality = Number("{{ x.sleepquality }}")
                            var breakfast = Number("{{ x.breakfast }}")
                            var hydration = Number("{{ x.hydration }}")
                            var soreness = Number("{{ x.soreness }}")
                            var stress = Number("{{ x.stress }}")
                            var mood = Number("{{ x.mood }}")

                            console.log(hoursofsleep)

                            var total = hoursofsleep + sleepquality + breakfast + hydration + soreness + stress + mood
                            document.getElementById("total").innerHTML = total

                            function status() {
                                var status = "{{ x.status }}"

                                if (status == 'N') {
                                    document.getElementById("stat").style.color = "var(--red-accent)"
                                    document.getElementById("bor").style.border = "1px solid var(--red-accent)"
                                }
                                else if (status == 'Y') {
                                    document.getElementById("stat").style.color = "var(--green-accent)"
                                    document.getElementById("bor").style.border = "1px solid var(--green-accent)"
                                }
                            }

                            window.onload = function () {
                                status();
                            };
                        </script>

                        {% endfor %}
                        {% endif %}
                    </div>
                </div>

                <div class="col-lg-7 overflow-scroll" style="height: 100vh; padding: 20px 0 0 20px;">
                    <div class="col-scroll">

                        <!-- Buttons to select between spider and bar graph tabs -->
                        <button style="background-color: #1f2126; border: none; border-radius: 5px; height: 40px;" onclick="showBarGraphs()">Bar Graph</button>
                        <button style="background-color: #1f2126; border: none; border-radius: 5px; height: 40px;" onclick="showSpiderGraphs()">Spider Graph</button>
                        <br><br>
                        <div id="spider-graphs" style="display:none">
                            <!-- Radar/Spider Graph -->
                            <div class="graphprof">
                                <form method="post" id="kpi_radar_form">
                                    {% csrf_token %}
                                    <div class="d-flex justify-content-between">
                                        <select id="radar_date" name="radar_date">
                                            <option disabled hidden selected>Select Date</option>
                                            <option selected>{{ kpi_most_recent }}</option>
                                            {% for x in all_dates %}
                                                <option>{{ x.datekpi }}</option>
                                            {% endfor %}
                                        </select>
                                        <input type="submit" value="submit" class="submit">
                                    </div>
                                    <br>
                                    <!-- If a date has been selected -->
                                    {% if radar_date %}
                                        <div>
                                            <form method="post" id="selected_radar_tests">
                                                {% csrf_token %}
                                                <!-- Passing radar_date as a session variable -->
                                                <input type="hidden" name="radar_date" id="radar_date_input" value="{{ radar_date }}">
                                                <!-- Checkboxes for the test types -->
                                                {% for test in all_tests %}
                                                    <input type="checkbox" id="{{ test }}" name="selected_radar_tests" value="{{ test }}">
                                                    <label for="{{ test }}">{{ test }}</label><br>
                                                {% endfor %}
                                                <hr> 
                                                <!-- Checkboxes for the comparisons -->                            
                                                <input type="checkbox" id="team_avg" name="compare_avg" value="team_avg">
                                                <label for="team_avg">Team Avg</label><br>
                                            
                                                <input type="checkbox" id="position_avg" name="compare_avg" value="position_avg">
                                                <label for="position_avg">Position Avg</label><br>
                                            
                                                <input type="checkbox" id="gender_avg" name="compare_avg" value="gender_avg">
                                                <label for="gender_avg">Gender Avg</label><br>
                                                <br>
                                                <input type="submit" value="Submit" class="submit">
                                            </form>                                            
                                        </div>
                                        <br>
                                        <!-- Display the spider graph or not -->
                                        {% if selected_radar_tests %}
                                            {% if selected_radar_tests|length > 2 %}
                                                {{ Radar_chart|safe }}
                                            {% else %}
                                                <p>Three tests are required to generate a spider graph.</p>
                                            {% endif %}
                                        {% endif %}
                                    {% endif %}
                                </form>
                            </div>

                            <script type="text/javascript">
                                let dateSelector = document.getElementById('radar_date');
                                let radarDateInput = document.getElementById('radar_date_input');

                                dateSelector.addEventListener('change', () => {
                                    radarDateInput.value = dateSelector.value;
                                });
                            </script>
                        </div>

                        <!-- Seperate Here -->

                        <div id="bar-graphs">
                            <!-- Date Selector + Settings-->
                            <div class="main-header justify-content-between">
                                <form method="post" id="kpiform" name="kpiform">
                                    {% csrf_token %}
                                    <select id="date1" name="date1">
                                        <option selected>{{ kpi_earliest }}</option>
                                        {% for x in all_dates %}
                                        <option>{{ x.datekpi }}</option>
                                        {% endfor %}
                                    </select>
                                    to
                                    <select id="date2" name="date2">
                                        <option selected>{{ kpi_most_recent }}</option>
                                        {% for x in all_dates %}
                                        <option>{{ x.datekpi }}</option>
                                        {% endfor %}
                                    </select>
                                    <input type="submit" value="submit" class="submit">
                                </form>
                                <i class="fa-solid fa-gear" style="color: var(--yellow-accent); font-size: 25px;"></i>
                            </div>

                            <!-- Graphs -->
                            {% for x in kpi_test_data %}

                            <div class="graphprof">
                                <div class="d-flex flex-column">

                                    <div class="d-flex">
                                        <h3>{{ x|get:'test_type' }}</h3>
                                    </div>
                                    <img src="data:image/png;base64, {{x|get:'bar_graph'|safe}}">

                                </div>
                            </div>

                            <script type="text/javascript">
                                
                                let selection1 = document.getElementById('date1');
                                let date1 = document.getElementById('resultone');


                                var date_one = "{{ date_one }}"
                                document.getElementById("resultone").innerHTML = date_one
                                if (date_one != "None") {
                                    document.getElementById("resultone").innerHTML = date_one
                                }

                                let selection2 = document.getElementById('date2');
                                let date2 = document.getElementById('resulttwo');


                                var date_two = "{{ date_two }}"
                                document.getElementById("resulttwo").innerHTML = date_two
                                if (date_two != "None") {
                                    document.getElementById("resulttwo").innerHTML = date_two
                                }

                                let selection3 = document.getElementById('wellnessdate');
                                let date3 = document.getElementById('wellnessresult');

                                var mostrecentdate = "{{ mostRecentWellnessReportDate }}"
                                document.getElementById("wellnessresult").innerHTML = mostrecentdate
                                var wellness_date = "{{ wellness_date }}"

                                if (wellness_date != "None") {
                                    document.getElementById("wellnessresult").innerHTML = wellness_date
                                }

                                selection1.addEventListener('change', () => {
                                    resultone.innerText = selection1.options[selection1.selectedIndex].text;
                                });

                                selection2.addEventListener('change', () => {
                                    resulttwo.innerText = selection2.options[selection2.selectedIndex].text;
                                });

                                selection3.addEventListener('change', () => {
                                    wellnessresult.innerText = selection3.options[selection3.selectedIndex].text;
                                });
                            </script>
                            {% endfor %}
                            

                            <script>
                                function showSpiderGraphs() {
                                    document.getElementById("spider-graphs").style.display = "block";
                                    document.getElementById("bar-graphs").style.display = "none";
                                }

                                function showBarGraphs() {
                                    document.getElementById("spider-graphs").style.display = "none";
                                    document.getElementById("bar-graphs").style.display = "block";
                                }
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>